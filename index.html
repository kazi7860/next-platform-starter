<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.I. Trading Bot - Final Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0e17; color: #e0e0e0; }
        .card { background-color: #161a25; border: 1px solid #2a3042; }
        .text-glow { text-shadow: 0 0 10px rgba(96, 165, 250, 0.7); }
        .input-group { background-color: #0a0e17; border: 1px solid #30363d; border-radius: 0.75rem; transition: all 0.2s ease; }
        .input-group:focus-within, .input-group:hover { border-color: #58a6ff; box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2); }
        .select-arrow { pointer-events: none; position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); color: #60a5fa; }
        .btn-primary { background: linear-gradient(90deg, #3b82f6, #6366f1); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4); }
        .btn-primary:disabled { background: #374151; cursor: not-allowed; opacity: 0.7; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .prediction-box { font-family: 'Roboto Mono', monospace; padding: 1.5rem; border-radius: 0.75rem; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; animation: fadeIn 0.5s ease; border: 1px solid; }
        .prediction-up { background-color: rgba(16, 185, 129, 0.1); border-color: #10b981; }
        .prediction-down { background-color: rgba(239, 68, 68, 0.1); border-color: #ef4444; }
        .prediction-wait { background-color: rgba(245, 158, 11, 0.1); border-color: #f59e0b; }
        .indicator-grid { display: grid; grid-template-columns: auto 1fr auto 1fr; align-items: center; gap: 0.5rem 1.5rem; }
        input[type="radio"].radio-btn { display: none; }
        input[type="radio"].radio-btn + label { display: block; padding: 0.5rem; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s ease; border: 1px solid #30363d; text-align: center; }
        input[type="radio"].radio-btn:checked + label { background-color: #3b82f6; color: white; border-color: #3b82f6; font-weight: 600; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <main class="w-full max-w-md card p-6 sm:p-8 rounded-2xl shadow-2xl">
        <div class="text-center mb-6"><h1 class="text-3xl font-bold text-white text-glow">A.I. TRADING BOT</h1></div>
        
        <div class="text-center text-xs mb-6 space-y-1 text-gray-400">
            <p>টাইম জোন: <span id="timeZoneDisplay">--</span></p>
            <p>তারিখ: <span id="dateDisplay">--</span></p>
            <p>সময়: <span id="timeDisplay" class="font-mono">--</span></p>
        </div>

        <div class="card p-4 mb-6 text-sm">
            <div class="indicator-grid">
                <span class="text-gray-400">মূল্য:</span><span id="currentPriceDisplay" class="font-semibold text-blue-400">--</span>
                <span class="text-gray-400">RSI:</span><span id="rsiDisplay" class="font-semibold">--</span>
                <span class="text-gray-400">সাপোর্ট:</span><span id="supportLevelDisplay" class="font-semibold text-green-400">--</span>
                <span class="text-gray-400">রেসিস্ট্যান্স:</span><span id="resistanceLevelDisplay" class="font-semibold text-red-400">--</span>
                <span class="text-gray-400">শর্ট MA:</span><span id="shortMADisplay" class="font-semibold">--</span>
                <span class="text-gray-400">লং MA:</span><span id="longMADisplay" class="font-semibold">--</span>
            </div>
        </div>

        <div class="space-y-4">
            <div class="input-group"><div class="relative"><select id="asset-select" class="w-full p-3 rounded-lg bg-transparent appearance-none focus:outline-none"><option value="" disabled selected>-- আপনার দেওয়া অ্যাসেট তালিকা --</option><option value="EURCHF">EUR/CHF</option><option value="EURGBP">EUR/GBP</option><option value="EURJPY">EUR/JPY</option><option value="GBPCAD">GBP/CAD</option><option value="GBPUSD">GBP/USD</option><option value="EURUSD">EUR/USD</option><option value="GBPJPY">GBP/JPY</option><option value="GBPAUD">GBP/AUD</option><option value="USDCAD">USD/CAD</option><option value="USDCHF">USD/CHF</option><option value="USDJPY">USD/JPY</option><option value="AUDUSD">AUD/USD</option><option value="GBPCHF">GBP/CHF</option><option value="AUDCAD">AUD/CAD</option><option value="AUDCHF">AUD/CHF</option><option value="AUDJPY">AUD/JPY</option><option value="CADJPY">CAD/JPY</option><option value="CHFJPY">CHF/JPY</option><option value="EURAUD">EUR/AUD</option><option value="EURCAD">EUR/CAD</option></select><div class="select-arrow">▼</div></div></div>
            <div class="input-group p-1 flex justify-around">
                <input type="radio" name="timeframe" value="1min" id="tf-1m" checked class="radio-btn"><label for="tf-1m" class="w-full">1m</label>
                <input type="radio" name="timeframe" value="5min" id="tf-5m" class="radio-btn"><label for="tf-5m" class="w-full">5m</label>
            </div>
        </div>
        
        <button id="predict-btn" class="w-full mt-8 py-4 px-6 rounded-lg font-bold text-lg btn-primary text-white">সুযোগ খুঁজুন</button>
        <div id="prediction-display-area" class="mt-6"></div>
    </main>
    <div id="messageBoxOverlay" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50"><div class="card p-8 rounded-lg shadow-xl text-center"><p id="messageBoxText" class="text-lg mb-6"></p><button id="messageBoxCloseButton" class="w-full py-2 px-6 rounded-lg font-bold btn-primary text-white">বন্ধ করুন</button></div></div>
    
    <script>
        const API_SERVER_URL = 'https://quotex-vip-bot.onrender.com';

        // --- DOM Elements (সঠিকভাবে লিঙ্ক করা) ---
        const dom = {
            predictBtn: document.getElementById('predict-btn'),
            assetSelect: document.getElementById('asset-select'),
            predictionArea: document.getElementById('prediction-display-area'),
            timeZone: document.getElementById('timeZoneDisplay'),
            date: document.getElementById('dateDisplay'),
            time: document.getElementById('timeDisplay'),
            price: document.getElementById('currentPriceDisplay'),
            support: document.getElementById('supportLevelDisplay'),
            resistance: document.getElementById('resistanceLevelDisplay'),
            rsi: document.getElementById('rsiDisplay'),
            shortMA: document.getElementById('shortMADisplay'),
            longMA: document.getElementById('longMADisplay'),
            messageBox: document.getElementById('messageBoxOverlay'),
            messageText: document.getElementById('messageBoxText'),
            messageClose: document.getElementById('messageBoxCloseButton'),
        };

        let marketUpdateInterval = null;

        // --- Utility Functions ---
        function showMessageBox(message) {
            dom.messageText.innerText = message;
            dom.messageBox.style.display = 'flex';
        }

        function updateDateTime() {
            const now = new Date();
            dom.timeZone.textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;
            dom.date.textContent = now.toLocaleDateString('bn-BD');
            dom.time.textContent = now.toLocaleTimeString('bn-BD');
        }

        function updateIndicators(data) {
            if (!data) {
                ['price', 'support', 'resistance', 'rsi', 'shortMA', 'longMA'].forEach(k => {
                    if (dom[k]) dom[k].textContent = '--';
                });
                return;
            }
            const { latest_price, support, resistance, latest_rsi, short_ma, latest_sma } = data;
            const p = (v, prec) => (v != null) ? Number(v).toFixed(prec) : '--';
            const pricePrec = (latest_price && latest_price < 10) ? 5 : 2;
            
            dom.price.textContent = p(latest_price, pricePrec);
            dom.support.textContent = p(support, pricePrec);
            dom.resistance.textContent = p(resistance, pricePrec);
            dom.rsi.textContent = p(latest_rsi, 2);
            dom.shortMA.textContent = p(short_ma, pricePrec);
            dom.longMA.textContent = p(latest_sma, pricePrec);
        }

        function displayPrediction(prediction) {
            const { decision, reason } = prediction;
            const box = dom.predictionArea;
            box.innerHTML = '';
            
            let boxClass = 'prediction-wait';
            let icon = '⏳';
            if (decision === 'UP') { boxClass = 'prediction-up'; icon = '⬆️'; }
            if (decision === 'DOWN') { boxClass = 'prediction-down'; icon = '⬇️'; }

            box.innerHTML = `
                <div class="prediction-box ${boxClass}">
                    <div class="text-2xl font-bold mb-2">Next Candle: ${decision} ${icon}</div>
                    <div class="text-xs text-gray-400">${reason}</div>
                </div>
            `;
        }

        // --- Core Functions ---
        async function fetchPrediction() {
            const options = {
                asset: dom.assetSelect.value,
                timeframe: document.querySelector('input[name="timeframe"]:checked').value,
            };
            if (!options.asset) {
                showMessageBox("অনুগ্রহ করে একটি অ্যাসেট নির্বাচন করুন।");
                return;
            }
            
            dom.predictionArea.innerHTML = `<div class="text-center p-4 text-gray-400 animate-pulse">বিশ্লেষণ করা হচ্ছে...</div>`;
            dom.predictBtn.disabled = true;
            dom.predictBtn.textContent = 'স্ক্যানিং...';

            try {
                const response = await fetch(`${API_SERVER_URL}/get-prediction`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(options),
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'সার্ভার থেকে একটি অজানা ত্রুটি');
                
                updateIndicators(data.market_data);
                displayPrediction(data.prediction);
                
            } catch (error) {
                dom.predictionArea.innerHTML = '';
                updateIndicators(null);
                showMessageBox(`সমস্যা: ${error.message}`);
            } finally {
                dom.predictBtn.disabled = false;
                dom.predictBtn.textContent = 'সুযোগ খুঁজুন';
            }
        }

        async function fetchMarketUpdate() {
            const asset = dom.assetSelect.value;
            if (!asset) return;
            try {
                const response = await fetch(`${API_SERVER_URL}/get-market-update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ asset, timeframe: document.querySelector('input[name="timeframe"]:checked').value }),
                });
                if (!response.ok) return;
                const data = await response.json();
                updateIndicators(data);
            } catch (error) {
                console.error("Indicator update failed:", error);
                if(marketUpdateInterval) clearInterval(marketUpdateInterval); // সমস্যা হলে টাইমার বন্ধ করা
            }
        }

        // --- Event Listeners ---
        dom.predictBtn.addEventListener('click', fetchPrediction);
        dom.messageClose.addEventListener('click', () => { dom.messageBox.style.display = 'none'; });
        
        dom.assetSelect.addEventListener('change', () => {
            if (marketUpdateInterval) clearInterval(marketUpdateInterval);
            dom.predictionArea.innerHTML = '';
            updateIndicators(null); // আগের ডেটা মুছে ফেলা
            fetchMarketUpdate(); // তাৎক্ষণিকভাবে প্রথম আপডেট
            marketUpdateInterval = setInterval(fetchMarketUpdate, 15000); // প্রতি ১৫ সেকেন্ডে আপডেট
        });

        // --- Initial Load ---
        updateDateTime();
        setInterval(updateDateTime, 1000);
    </script>
</body>
</html>